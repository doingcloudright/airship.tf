<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Airship Modules | Airship Modules</title>
    <meta name="description" content="Flexible Terraform templates help setting up your Docker Orchestration platform, resources 100% supported by Amazon">
    
    
    <link rel="preload" href="/airship.tf/assets/css/0.styles.c084f234.css" as="style"><link rel="preload" href="/airship.tf/assets/js/app.4cee3cc5.js" as="script"><link rel="preload" href="/airship.tf/assets/js/20.c5c3716d.js" as="script"><link rel="preload" href="/airship.tf/assets/js/2.07fac88e.js" as="script"><link rel="prefetch" href="/airship.tf/assets/js/1.965ea306.js"><link rel="prefetch" href="/airship.tf/assets/js/10.06dee672.js"><link rel="prefetch" href="/airship.tf/assets/js/11.28d6581f.js"><link rel="prefetch" href="/airship.tf/assets/js/12.eb597dd5.js"><link rel="prefetch" href="/airship.tf/assets/js/13.d2c0c577.js"><link rel="prefetch" href="/airship.tf/assets/js/14.eec9b810.js"><link rel="prefetch" href="/airship.tf/assets/js/15.147d7810.js"><link rel="prefetch" href="/airship.tf/assets/js/16.18ebfa36.js"><link rel="prefetch" href="/airship.tf/assets/js/17.d163eb79.js"><link rel="prefetch" href="/airship.tf/assets/js/21.f34d5b4a.js"><link rel="prefetch" href="/airship.tf/assets/js/22.3c8f8f25.js"><link rel="prefetch" href="/airship.tf/assets/js/23.67dd923d.js"><link rel="prefetch" href="/airship.tf/assets/js/24.dd4a7491.js"><link rel="prefetch" href="/airship.tf/assets/js/25.7ec91b0b.js"><link rel="prefetch" href="/airship.tf/assets/js/26.d04e78c1.js"><link rel="prefetch" href="/airship.tf/assets/js/27.5afa5ae2.js"><link rel="prefetch" href="/airship.tf/assets/js/28.019b8d38.js"><link rel="prefetch" href="/airship.tf/assets/js/29.0ab72ade.js"><link rel="prefetch" href="/airship.tf/assets/js/3.45ad0597.js"><link rel="prefetch" href="/airship.tf/assets/js/30.3ab445cb.js"><link rel="prefetch" href="/airship.tf/assets/js/31.e2405844.js"><link rel="prefetch" href="/airship.tf/assets/js/32.a45f980f.js"><link rel="prefetch" href="/airship.tf/assets/js/33.532d1160.js"><link rel="prefetch" href="/airship.tf/assets/js/34.b30eeb32.js"><link rel="prefetch" href="/airship.tf/assets/js/35.9fa3ec65.js"><link rel="prefetch" href="/airship.tf/assets/js/36.b2b1fdd5.js"><link rel="prefetch" href="/airship.tf/assets/js/37.526a455a.js"><link rel="prefetch" href="/airship.tf/assets/js/38.7c311cbd.js"><link rel="prefetch" href="/airship.tf/assets/js/39.79e10685.js"><link rel="prefetch" href="/airship.tf/assets/js/4.47100ef6.js"><link rel="prefetch" href="/airship.tf/assets/js/40.81e3d38e.js"><link rel="prefetch" href="/airship.tf/assets/js/41.ada57e2d.js"><link rel="prefetch" href="/airship.tf/assets/js/42.b53f97fd.js"><link rel="prefetch" href="/airship.tf/assets/js/43.522e7415.js"><link rel="prefetch" href="/airship.tf/assets/js/44.faa0ea91.js"><link rel="prefetch" href="/airship.tf/assets/js/45.b12c9c87.js"><link rel="prefetch" href="/airship.tf/assets/js/5.5f33e6ff.js"><link rel="prefetch" href="/airship.tf/assets/js/6.b876cc7d.js"><link rel="prefetch" href="/airship.tf/assets/js/7.9de6e1cc.js"><link rel="prefetch" href="/airship.tf/assets/js/8.72121fe3.js"><link rel="prefetch" href="/airship.tf/assets/js/9.f18940a9.js"><link rel="prefetch" href="/airship.tf/assets/js/vendors~docsearch.259d7d1e.js">
    <link rel="stylesheet" href="/airship.tf/assets/css/0.styles.c084f234.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/airship.tf/" class="home-link router-link-active"><img src="/airship.tf/airship.png" alt="Airship Modules" class="logo"> <span class="site-name can-hide">Airship Modules</span></a> <div class="links"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/airship.tf/" class="nav-link">Home</a></div><div class="nav-item"><a href="/airship.tf/introduction/" class="nav-link">Introduction</a></div><div class="nav-item"><a href="/airship.tf/getting_started/" class="nav-link router-link-active">Getting Started</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Start</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/airship.tf/guide/ecs_cluster/" class="nav-link">ECS Cluster</a></li><li class="dropdown-subitem"><a href="/airship.tf/guide/ecs_service/" class="nav-link">ECS Service</a></li></ul></li></ul></div></div> <a href="https://github.com/blinkist/terraform-aws-airship-ecs-service" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/airship.tf/" class="nav-link">Home</a></div><div class="nav-item"><a href="/airship.tf/introduction/" class="nav-link">Introduction</a></div><div class="nav-item"><a href="/airship.tf/getting_started/" class="nav-link router-link-active">Getting Started</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Start</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/airship.tf/guide/ecs_cluster/" class="nav-link">ECS Cluster</a></li><li class="dropdown-subitem"><a href="/airship.tf/guide/ecs_service/" class="nav-link">ECS Service</a></li></ul></li></ul></div></div> <a href="https://github.com/blinkist/terraform-aws-airship-ecs-service" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/airship.tf/getting_started/" class="sidebar-link">Start</a></li><li><a href="/airship.tf/getting_started/preparation.html" class="sidebar-link">Preparation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/airship.tf/getting_started/preparation.html#vpc" class="sidebar-link">VPC</a></li><li class="sidebar-sub-header"><a href="/airship.tf/getting_started/preparation.html#security-groups" class="sidebar-link">Security Groups</a></li><li class="sidebar-sub-header"><a href="/airship.tf/getting_started/preparation.html#route53-zone" class="sidebar-link">Route53 Zone</a></li><li class="sidebar-sub-header"><a href="/airship.tf/getting_started/preparation.html#application-load-balancer" class="sidebar-link">Application Load Balancer</a></li></ul></li><li><a href="/airship.tf/getting_started/airship.html" class="active sidebar-link">Airship Modules</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/airship.tf/getting_started/airship.html#airship-ecs-cluster" class="sidebar-link">Airship ECS Cluster</a></li><li class="sidebar-sub-header"><a href="/airship.tf/getting_started/airship.html#airship-ecs-service" class="sidebar-link">Airship ECS Service</a></li></ul></li><li><a href="/airship.tf/getting_started/liftoff.html" class="sidebar-link">Lift off!</a></li><li><a href="/airship.tf/getting_started/troubleshooting.html" class="sidebar-link">Trouble Shooting</a></li></ul> </div> <div class="page"> <div class="content default"><h1 id="airship-modules"><a href="#airship-modules" aria-hidden="true" class="header-anchor">#</a> Airship Modules</h1> <p>Now that you've setup everything needed for Airship, we need to add the use of the airship modules to get a docker service running.</p> <h2 id="airship-ecs-cluster"><a href="#airship-ecs-cluster" aria-hidden="true" class="header-anchor">#</a> Airship ECS Cluster</h2> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>It's important to have finished the preparation steps before you continue here.</p></div> <p>The <a href="https://github.com/blinkist/terraform-aws-airship-ecs-cluster" target="_blank" rel="noopener noreferrer">ECS Cluster<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> module will create the ECS Cluster in your region. The module can be used for both ECS Fargate and for running an ECS Cluster on top of EC2 instances. For this example we won't be needing EC2 instances so we configure the module to not use them.</p> <div class="language-json extra-class"><pre class="language-json"><code>module <span class="token string">&quot;ecs&quot;</span> <span class="token punctuation">{</span>
  source  = <span class="token string">&quot;blinkist/airship-ecs-cluster/aws&quot;</span>
  version = <span class="token string">&quot;0.5.1&quot;</span>

  name = <span class="token string">&quot;ecs-demo&quot;</span>

  # create_roles defines if we create IAM Roles for EC2 instances
  create_roles = <span class="token boolean">false</span>

  # create_autoscalinggroup defines if we create an ASG for ECS
  create_autoscalinggroup = <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Apply your added terraform code, in the EC2 Panel on the AWS Console you will see your newly created ECS Cluster.</p> <h2 id="airship-ecs-service"><a href="#airship-ecs-service" aria-hidden="true" class="header-anchor">#</a> Airship ECS Service</h2> <p>Now that we have an ECS Cluster, we need to add an actual service. For this demonstration, we will use a very standard <code>nginx:stable</code> docker image. A summary of the specifics of the service. Replace <code>&lt;YOUR REGION&gt;</code> with the active AWS region.</p> <ul class="contains-task-list"><li class="task-list-item"><input checked="checked" disabled="disabled" type="checkbox" class="task-list-item-checkbox"> This ECS Service uses Fargate</li> <li class="task-list-item"><input checked="checked" disabled="disabled" type="checkbox" class="task-list-item-checkbox"> The service is place inside a private subnet</li> <li class="task-list-item"><input checked="checked" disabled="disabled" type="checkbox" class="task-list-item-checkbox"> HTTP is automatically redirected to https</li> <li class="task-list-item"><input checked="checked" disabled="disabled" type="checkbox" class="task-list-item-checkbox"> Service is available through HTTPS</li> <li class="task-list-item"><input checked="checked" disabled="disabled" type="checkbox" class="task-list-item-checkbox"> The ALB is polling / on the docker service and checks for a HTTP 200</li></ul> <div class="language-json extra-class"><pre class="language-json"><code>module <span class="token string">&quot;fargate_service&quot;</span> <span class="token punctuation">{</span>
  source  = <span class="token string">&quot;blinkist/airship-ecs-service/aws&quot;</span>
  version = <span class="token string">&quot;0.9.2&quot;</span>

  name = <span class="token string">&quot;demo-web&quot;</span>

  ecs_cluster_id = <span class="token string">&quot;${module.ecs.cluster_id}&quot;</span>

  region = <span class="token string">&quot;&lt;YOUR REGION&gt;&quot;</span>


  fargate_enabled = <span class="token boolean">true</span>

  awsvpc_enabled            = <span class="token boolean">true</span>
  awsvpc_subnets            = <span class="token punctuation">[</span><span class="token string">&quot;${module.vpc.private_subnets}&quot;</span><span class="token punctuation">]</span>
  awsvpc_security_group_ids = <span class="token punctuation">[</span><span class="token string">&quot;${aws_security_group.ecs_service_sg.id}&quot;</span><span class="token punctuation">]</span>

  load_balancing_type = <span class="token string">&quot;application&quot;</span>
  load_balancing_properties <span class="token punctuation">{</span>
    # The ARN of the ALB<span class="token punctuation">,</span> when left-out the service<span class="token punctuation">,</span> 
  load_balancing_properties_lb_arn = <span class="token string">&quot;${module.alb_shared_services_external.load_balancer_id}&quot;</span>

  # http listener ARN
  load_balancing_properties_lb_listener_arn = <span class="token string">&quot;${element(module.alb_shared_services_external.http_tcp_listener_arns,0)}&quot;</span>

  # The VPC_ID the target_group is being created in
  load_balancing_properties_lb_vpc_id = <span class="token string">&quot;${module.vpc.vpc_id}&quot;</span>

  # The route53 zone for which we create a subdomain
  load_balancing_properties_route53_zone_id = <span class="token string">&quot;${data.aws_route53_zone.zone.zone_id}&quot;</span>

  # health_uri defines which health-check uri the target 
  # group needs to check on for health_check<span class="token punctuation">,</span> defaults to /ping
  load_balancing_properties_health_uri = <span class="token string">&quot;/&quot;</span>

  load_balancing_properties_https_enabled = <span class="token boolean">false</span>


  container_cpu = <span class="token number">256</span>
  container_memory = <span class="token number">512</span>
  container_port   = <span class="token number">80</span>
  bootstrap_container_image = <span class="token string">&quot;nginx:stable&quot;</span>

  # force_bootstrap_container_image to <span class="token boolean">true</span> will 
  # force the deployment to use var.bootstrap_container_image as container_image
  # if container_image is already deployed<span class="token punctuation">,</span> no actual service update will happen
  # force_bootstrap_container_image = <span class="token boolean">false</span>

  # Initial ENV Variables for the ECS Task definition
  container_envvars <span class="token punctuation">{</span>
    ENV_VARIABLE = <span class="token string">&quot;SOMETHING&quot;</span>
  <span class="token punctuation">}</span>
  # capacity_properties defines the size in task for the ECS Service.
  # Without scaling enabled<span class="token punctuation">,</span> desired_capacity is the only necessary property
  # defaults to <span class="token number">2</span>
  # With scaling enabled<span class="token punctuation">,</span> desired_min_capacity and desired_max_capacity 
  # define the lower and upper boundary in task size
  capacity_properties_desired_capacity = <span class="token string">&quot;1&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/airship.tf/getting_started/preparation.html" class="prev">
          Preparation
        </a></span> <span class="next"><a href="/airship.tf/getting_started/liftoff.html">
          Lift off!
        </a>
        →
      </span></p></div> </div></div><div class="global-ui"></div></div>
    <script src="/airship.tf/assets/js/app.4cee3cc5.js" defer></script><script src="/airship.tf/assets/js/20.c5c3716d.js" defer></script><script src="/airship.tf/assets/js/2.07fac88e.js" defer></script>
  </body>
</html>
