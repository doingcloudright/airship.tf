(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{193:function(e,t,r){"use strict";r.r(t);var a=r(18),o=Object(a.a)({},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"networking"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#networking","aria-hidden":"true"}},[e._v("#")]),e._v(" Networking")]),e._v(" "),r("h2",{attrs:{id:"introduction"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#introduction","aria-hidden":"true"}},[e._v("#")]),e._v(" Introduction")]),e._v(" "),r("mermaid"),e._v(" "),r("p",[e._v("There are two types of networking for ECS. The ECS Task definitinion defines a network-mode, the two modes available are 'bridge' and 'awsvpc'.")]),e._v(" "),r("h2",{attrs:{id:"network-mode-bridge"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#network-mode-bridge","aria-hidden":"true"}},[e._v("#")]),e._v(" Network-mode: bridge")]),e._v(" "),r("p",[e._v("Bridge is only used for ECS Service which are run on top of EC2 Instances which joined the ECS Cluster. The service does not have their own Network Interface and will\ninherit the Networking of their Docker Host. As different different tasks cannot allocate the same port on the docker host, ECS uses "),r("a",{attrs:{href:"https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_PortMapping.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Dynamic Port Mapping"),r("OutboundLink")],1),e._v(", which allocated ports in the ephemeral port range from 49153 through 65535. The Security Group of the EC2 Instance needs to allow traffic from the Load Balancer to these ports.")]),e._v(" "),r("center",[r("div",{staticClass:"mermaid"},[e._v("\ngraph TD \n    subgraph EC2 Instance\n    A[ECS Task A]-.->D\n    B[ECS Task A]-.->D\n    C[ECS Task B]-.->D\n    D{ENI}\n    end\n    D-.->E[Security Group X]\n    D-.->F[Security Group Y]\n    classDef green fill:#9f6,stroke:#333,stroke-width:2px;\n    class D green\n")])]),e._v(" "),r("h2",{attrs:{id:"network-mode-awsvpc"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#network-mode-awsvpc","aria-hidden":"true"}},[e._v("#")]),e._v(" Network-mode: awsvpc")]),e._v(" "),r("p",[e._v("awsvpc network-mode is mandatory on Fargate and optional on EC2. The ECS Task will have its own ENI and will also have its own Security Group. The "),r("code",[e._v("container_port")]),e._v(" parameter will also be used to expose the port on its network interface. A security group rule would need to allow traffic to this port. Using awsvpc with EC2 ECS is limited as the amount of available network interfaces per EC2 instance is extremely limited. "),r("a",{attrs:{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html#AvailableIpPerENI",target:"_blank",rel:"noopener noreferrer"}},[e._v("This"),r("OutboundLink")],1),e._v(" table shows the amount of ENI's available per instance type. Check out the "),r("a",{attrs:{href:"https://github.com/aws/containers-roadmap/issues/7",target:"_blank",rel:"noopener noreferrer"}},[e._v("AWS Container Roadmap"),r("OutboundLink")],1),e._v("!")]),e._v(" "),r("center",[r("div",{staticClass:"mermaid"},[e._v("\ngraph LR\n    subgraph ECS Task\n    D{ENI}\n    end\n    D-.->E[Security Group X]\n    D-.->F[Security Group Y]\n    classDef green fill:#9f6,stroke:#333,stroke-width:2px;\n    class D green\n")])]),e._v(" "),r("div",{staticClass:"tip custom-block"},[r("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),r("p",[e._v("For both network modes the security groups need to allow outgoing traffic to communicate with AWS, for example to pull ECR Docker images.")])]),e._v(" "),r("div",{staticClass:"warning custom-block"},[r("p",{staticClass:"custom-block-title"},[e._v("Warning for Network Load Balancer (NLB) Users!")]),e._v(" "),r("p",[e._v("A NLB acts transparantly and does not have a Security Group, this implies that ECS Services which need to allow traffic from a NLB need a wide open security group rule in case it needs to be reachable from the internet. It's advised to use awsvpc network mode for this as the service will have it's own Security Group then.")])])],1)},[],!1,null,null,null);o.options.__file="networking.md";t.default=o.exports}}]);